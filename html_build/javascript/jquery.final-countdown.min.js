!function($){var settings,timer,circleSeconds,circleMinutes,circleHours,circleDays,layerSeconds,layerMinutes,layerHours,layerDays,element,callbackFunction;function updateCircles(){layerSeconds.draw(),layerMinutes.draw(),layerHours.draw(),layerDays.draw()}function convertToDeg(degree){return Math.PI/180*degree-Math.PI/180*90}$.fn.final_countdown=function(options,callback){if((element=$(this)).is(":visible")){var interval,defaults=$.extend({start:void 0,end:void 0,now:void 0,selectors:{value_seconds:".clock-seconds .val",canvas_seconds:"canvas-seconds",value_minutes:".clock-minutes .val",canvas_minutes:"canvas-minutes",value_hours:".clock-hours .val",canvas_hours:"canvas-hours",value_days:".clock-days .val",canvas_days:"canvas-days"},seconds:{borderColor:"#7995D5",borderWidth:"6"},minutes:{borderColor:"#ACC742",borderWidth:"6"},hours:{borderColor:"#ECEFCB",borderWidth:"6"},days:{borderColor:"#FF9900",borderWidth:"6"}},options);void 0===(settings=$.extend({},defaults,options)).start&&(settings.start=element.data("start")),void 0===settings.end&&(settings.end=element.data("end")),void 0===settings.now&&(settings.now=element.data("now")),element.data("border-color")&&(settings.seconds.borderColor=settings.minutes.borderColor=settings.hours.borderColor=settings.days.borderColor=element.data("border-color")),settings.now<settings.start&&(settings.start=settings.now,settings.end=settings.now),settings.now>settings.end&&(settings.start=settings.now,settings.end=settings.now),"function"==typeof callback&&(callbackFunction=callback),$(window).load(updateCircles),$(window).on("redraw",function(){switched=!1,updateCircles()}),$(window).on("resize",updateCircles),timer={total:Math.floor((settings.end-settings.start)/86400),days:Math.floor((settings.end-settings.now)/86400),hours:24-Math.floor((settings.end-settings.now)%86400/3600),minutes:60-Math.floor((settings.end-settings.now)%86400%3600/60),seconds:60-Math.floor((settings.end-settings.now)%86400%3600%60)},function(){var seconds_width=$("#"+settings.selectors.canvas_seconds).width(),secondsStage=new Kinetic.Stage({container:settings.selectors.canvas_seconds,width:seconds_width,height:seconds_width});circleSeconds=new Kinetic.Shape({drawFunc:function(context){var seconds_width=$("#"+settings.selectors.canvas_seconds).width(),radius=seconds_width/2-settings.seconds.borderWidth/2,x=seconds_width/2,y=seconds_width/2;context.beginPath(),context.arc(x,y,radius,convertToDeg(0),convertToDeg(6*timer.seconds)),context.fillStrokeShape(this),$(settings.selectors.value_seconds).html(60-timer.seconds)},stroke:settings.seconds.borderColor,strokeWidth:settings.seconds.borderWidth}),(layerSeconds=new Kinetic.Layer).add(circleSeconds),secondsStage.add(layerSeconds);var minutes_width=$("#"+settings.selectors.canvas_minutes).width(),minutesStage=new Kinetic.Stage({container:settings.selectors.canvas_minutes,width:minutes_width,height:minutes_width});circleMinutes=new Kinetic.Shape({drawFunc:function(context){var minutes_width=$("#"+settings.selectors.canvas_minutes).width(),radius=minutes_width/2-settings.minutes.borderWidth/2,x=minutes_width/2,y=minutes_width/2;context.beginPath(),context.arc(x,y,radius,convertToDeg(0),convertToDeg(6*timer.minutes)),context.fillStrokeShape(this),$(settings.selectors.value_minutes).html(60-timer.minutes)},stroke:settings.minutes.borderColor,strokeWidth:settings.minutes.borderWidth}),(layerMinutes=new Kinetic.Layer).add(circleMinutes),minutesStage.add(layerMinutes);var hours_width=$("#"+settings.selectors.canvas_hours).width(),hoursStage=new Kinetic.Stage({container:settings.selectors.canvas_hours,width:hours_width,height:hours_width});circleHours=new Kinetic.Shape({drawFunc:function(context){var hours_width=$("#"+settings.selectors.canvas_hours).width(),radius=hours_width/2-settings.hours.borderWidth/2,x=hours_width/2,y=hours_width/2;context.beginPath(),context.arc(x,y,radius,convertToDeg(0),convertToDeg(360*timer.hours/24)),context.fillStrokeShape(this),$(settings.selectors.value_hours).html(24-timer.hours)},stroke:settings.hours.borderColor,strokeWidth:settings.hours.borderWidth}),(layerHours=new Kinetic.Layer).add(circleHours),hoursStage.add(layerHours);var days_width=$("#"+settings.selectors.canvas_days).width(),daysStage=new Kinetic.Stage({container:settings.selectors.canvas_days,width:days_width,height:days_width});circleDays=new Kinetic.Shape({drawFunc:function(context){var days_width=$("#"+settings.selectors.canvas_days).width(),radius=days_width/2-settings.days.borderWidth/2,x=days_width/2,y=days_width/2;context.beginPath(),0==timer.total?context.arc(x,y,radius,convertToDeg(0),convertToDeg(360)):context.arc(x,y,radius,convertToDeg(0),convertToDeg(360/timer.total*(timer.total-timer.days))),context.fillStrokeShape(this),$(settings.selectors.value_days).html(timer.days)},stroke:settings.days.borderColor,strokeWidth:settings.days.borderWidth}),(layerDays=new Kinetic.Layer).add(circleDays),daysStage.add(layerDays)}(),interval=setInterval(function(){if(59<timer.seconds){if(60-timer.minutes==0&&24-timer.hours==0&&0==timer.days)return clearInterval(interval),void(void 0!==callbackFunction&&callbackFunction.call(this));timer.seconds=1,59<timer.minutes?(timer.minutes=1,layerMinutes.draw(),23<timer.hours?(timer.hours=1,0<timer.days&&(timer.days--,layerDays.draw())):timer.hours++,layerHours.draw()):timer.minutes++,layerMinutes.draw()}else timer.seconds++;layerSeconds.draw()},1e3)}}}(jQuery);